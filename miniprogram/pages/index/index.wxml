<!--index.wxml-->
<navigation-bar title="é£Ÿç‰©æµªè´¹è¯†åˆ«" back="{{false}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- æ¬¢è¿ä¿¡æ¯ -->
    <view class="welcome-section">
      <text class="welcome-title">æ¬¢è¿ä½¿ç”¨é£Ÿç‰©æµªè´¹è¯†åˆ«</text>
      <text class="welcome-desc">æ‹æ‘„æˆ–ä¸Šä¼ é£Ÿç‰©å›¾ç‰‡ï¼ŒAIå°†å¸®æ‚¨åˆ†ææµªè´¹æƒ…å†µ</text>
    </view>
    
    <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
    <view class="upload-section">
      <view class="upload-buttons" wx:if="{{!tempImagePath}}">
        <button class="upload-btn camera" bindtap="takePhoto">
          <text class="icon">ğŸ“·</text>
          <text>æ‹ç…§</text>
        </button>
        <button class="upload-btn album" bindtap="chooseFromAlbum">
          <text class="icon">ğŸ–¼ï¸</text>
          <text>ä»ç›¸å†Œé€‰æ‹©</text>
        </button>
      </view>
      
      <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
      <view class="preview-section" wx:if="{{tempImagePath}}">
        <image class="preview-image" src="{{tempImagePath}}" mode="aspectFit"></image>
        <view class="preview-actions">
          <button class="action-btn" bindtap="reselect">é‡æ–°é€‰æ‹©</button>
          <button class="action-btn primary" bindtap="analyzeImage">å¼€å§‹åˆ†æ</button>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½åŠ¨ç”» -->
    <view class="loading-container" wx:if="{{isAnalyzing}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">AIæ­£åœ¨åˆ†æå›¾ç‰‡ä¸­...</text>
    </view>
    
    <!-- åˆ†æç»“æœåŒºåŸŸ -->
    <view class="result-section" wx:if="{{analysisResult}}">
      <view class="result-header">
        <text class="result-title">é£Ÿç‰©æµªè´¹åˆ†ææŠ¥å‘Š</text>
      </view>
      
      <!-- è¯†åˆ«ç»“æœåˆ—è¡¨ -->
      <view class="result-list" wx:if="{{analysisResult.items && analysisResult.items.length}}">
        <view class="result-item" wx:for="{{analysisResult.items}}" wx:key="name">
          <text class="item-name">{{item.name || 'æœªçŸ¥é£Ÿç‰©'}}</text>
          <text class="item-percentage">{{item.percentage !== undefined && item.percentage !== null ? item.percentage : 0}}%</text>
        </view>
      </view>
      <view class="empty-tip" wx:else>
        <text>æœªè¯†åˆ«åˆ°æœ‰æ•ˆé£Ÿç‰©æ•°æ®</text>
      </view>
      
      <!-- å›¾è¡¨åŒºåŸŸ -->
      <view class="chart-container">
        <ec-canvas id="mychart-dom-pie" canvas-id="mychart-pie" ec="{{ ec }}"></ec-canvas>
      </view>
      
      <!-- åˆ†ææ–‡æœ¬ -->
      <view class="analysis-text">
        <text class="analysis-title">æµªè´¹ç¨‹åº¦è¯„ä¼°</text>
        <text class="analysis-content">{{analysisResult.wasteLevel}}</text>
        
        <text class="analysis-title">æ”¹å–„å»ºè®®</text>
        <text class="analysis-content">{{analysisResult.suggestions}}</text>
      </view>
      
      <!-- é‡æ–°åˆ†ææŒ‰é’® -->
      <button class="restart-btn" bindtap="restart">é‡æ–°åˆ†æ</button>
    </view>
  </view>
</scroll-view>